# ADR-001: RFC 7807 Error Handling
Дата: 2025-10-22
Статус: Accepted

## Context
В проекте используется API, и часть эндпоинтов уже возвращает ошибки в разном формате.
Отсутствие единого стандарта мешает трассировке, автоматической обработке ошибок на клиенте и усложняет расследование инцидентов.

## Decision
Принято использовать формат ошибок [RFC 7807](https://datatracker.ietf.org/doc/html/rfc7807) для всех ответов с ошибкой.
Будет создан единый обработчик исключений, который возвращает JSON со структурой:
- `type`
- `title`
- `status`
- `detail`
- `correlation_id` (UUID)

Глобальный обработчик ошибок будет зарегистрирован в `app/main.py`.

## Alternatives
- **Без стандартизации** — оставить как есть.
  ❌ Нельзя трассировать, сложно тестировать.
- **Своя структура ошибок** — проще, но нет совместимости со стандартом и tooling.
  ⚠️ Возможна путаница с другими сервисами.
- ✅ **RFC 7807** — стандарт, поддерживается многими инструментами и библиотеками.

## Consequences
- Улучшается трассировка и observability.
- Возможность автоматической обработки ошибок.
- Небольшие изменения в коде и тестах.

## Security impact
- Уменьшение утечек чувствительной информации за счёт маскирования внутренних ошибок.
- Использование `correlation_id` упрощает расследование атак и инцидентов.

## Rollout plan
- Внедрить глобальный обработчик исключений.
- Заменить старые ответы на RFC7807 постепенно.
- Пилот на dev окружении.
- Полный rollout после успешных тестов.

## Links
- Threat Model: регистрация (R1–R7), логин (L1–L7), CRUD тренировок (W1–W9)
- RISKS: R3, R6
- tests/test_errors.py
- PR #p05-secure-coding
