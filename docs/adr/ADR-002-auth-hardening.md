# ADR-002: Rate Limiting /auth/register
Дата: 2025-10-22
Статус: Accepted

## Context
Регистрационный эндпоинт `/auth/register` уязвим к автоматизированным атакам —
бот может отправлять большое количество запросов, подбирая логины и пароли.
Это приводит к:
- брутфорс атакам на регистрацию,
- переполнению базы «мусорными» аккаунтами,
- нагрузке на сервис.

## Decision
Реализовать **rate limiting** на `/auth/register`:
- Порог — 5 попыток за 10 минут с блокировкой IP.
- При превышении лимита возвращается 429 с телом в формате RFC7807.
- Проверка и учёт попыток — in-memory.
- CAPTCHA обязательна для регистрации.

## Alternatives
- ❌ Без ограничений — высокий риск брутфорса.
- ⚠️ Защита только CAPTCHA — может быть обойдена.
- ✅ Rate limiting + CAPTCHA — минимальная нагрузка и хорошая защита.

## Consequences
- Снижена вероятность атак регистрации.
- Меньше мусорных пользователей.
- Появляется in-memory state.

## Security impact
- Устраняет риск R1.

## Rollout plan
-  Реализация rate limiting и CAPTCHA на уровне контроллера регистрации.
-  Юнит- и интеграционные тесты для превышения лимита и некорректного CAPTCHA.
-  Пилот на dev окружении.
-  Полный rollout после успешных нагрузочных тестов.

## Links
- Threat Model: регистрация (R1–R7)
- RISKS: R1
- tests/test_auth.py
- PR #p05-secure-coding
