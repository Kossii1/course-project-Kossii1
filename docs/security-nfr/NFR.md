# NFR (Non-Functional Requirements)

| ID     | Название                                 | Описание (кратко)                                      | Метрика / Порог                                              | Проверка (чем/где)                                            | Компонент | Приоритет |
|--------|------------------------------------------|--------------------------------------------------------|---------------------------------------------------------------|----------------------------------------------------------------|-----------|-----------|
| NFR-01 | Хранение паролей                         | Пароли хранятся только в безопасном виде (Argon2id)    | Argon2id t=3, m=256MB, p=1 (минимум)                          | Конфиг (passlib/bcrypt?), unit-тесты hash/verify               | auth      | High      |
| NFR-02 | Формат ошибок и PII                      | Все ошибки - стандартизованный RFC7807-подобный JSON; PII маскируется | 100% endpoint'ов возвращают `type,title,status,detail,correlation_id` | Контракт-тесты на ошибки + e2e, log-scan                       | api       | High      |
| NFR-03 | Защита аутентификации (rate-limit/CAPTCHA)| Защита регистраций и логинов от автоматических атак    | /auth/register: ≤5 попыток / 10 min per IP; логин rate-limit; CAPTCHA | Нагрузочные и интеграционные тесты, блокировка по IP, тест CAPTCHA | auth      | High      |
| NFR-04 | Устойчивость к DoS и латентность API     | Критичные API не должны деградировать при пиковых нагрузках | p95 ≤ 200 ms @ 100 RPS для критичных endpoint'ов; защита от массовых операций | Нагрузочные тесты (k6/Gatling), infra rate-limits, WAF rules   | api/infra | High      |
| NFR-05 | Управление доступом и проверка ownership | Все операции CRUD защищены проверкой ownership и RBAC | 100% write-операций проверяют owner/role; PR-coverage интеграционные тесты | Unit + интеграционные тесты ownership; SAST; code review       | api/auth  | High      |
| NFR-06 | Контроль доступа к данным (фильтрация)   | GET/листинги возвращают только авторизованные данные   | 100% GET фильтруются по user_id/filters; no leakage incidents | E2E тесты, проверка ответов, forensics при инциденте           | api       | High      |
| NFR-07 | Уязвимости зависимостей и CI             | Быстрая реакция на High/Critical в сторонних зависимостях | High/Critical → remediation или компенсирующий контроль ≤ 7 дней | CI SCA-сканы в pipeline + SBOM report                          | build     | High      |
| NFR-08 | Observability, tracing & correlation_id  | Полная трассировка запросов и структурированные логи   | 100% запросов имеют `correlation_id`; логи в JSON; retention 90d | Log-pipeline check, APM traces, e2e/ops playbook               | infra     | Medium    |
